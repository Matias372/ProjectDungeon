<?php
class Personaje{
    private $nombre;
    private $clase;
    private $nivel;
    //estadisticas basicas de clase
    private $fuerzaBasic;
    private $resistenciaBasic;
    private $destrezaBasic;
    private $magiaBasic;
    // estadisticas modificadas por usuario.
    private $fuerzaBonif;
    private $resistenciaBonif;
    private $destrezaBonif;
    private $magiaBonif;
    // puntos de estadistica para subir atributos de personaje
    private $statPoint;
    // estadisticas modificadas por equipos.
    private $fuerzaEquip;
    private $resistenciaEquip;
    private $destrezaEquip;
    private $magiaEquip;
    //atributos calculados
    private $HP_Max;
    private $MP_Max;
    private $Atk_Fisico;
    private $Atk_Magico;
    private $Def_Fisica;
    private $Def_Magica;
    private $Hit_rate;
    private $atk_speed;
    private $Crit_chance;
    private $FuerzaTotal;
    private $ResistenciaTotal;
    private $DestrezaTotal;
    private $MagiaTotal;

    //vida y mana actual del personaje
    private $HP_actual;
    private $MP_actual;
    //verifica la creacion del personaje nuevo o si ya es un personaje cargado.
    private $bonificacionesAplicadas;
    
    //======ESTADISTICAS PUBLICAS======
    public $Nombre;
    public $Clase;
    public $ClassIMG;
    public $Nivel;
    public $Fuerza;
    Public $Resistencia;
    Public $Destreza;   
    public $Magia;
    public $PuntosEstado;
    public $HP;
    public $MP;
    public $HPMax;
    public $MPMax;
    public $Ataque_Fisico;
    public $Ataque_Magico;
    public $Defensa_Fisica;
    public $Defensa_Magica;
    public $Hit_Rate;
    public $Velocidad_Ataque;
    public $Critical_Chance;
    //COLOCAR MAS...


    //=============================CONSTRUCTOR=============================

    // Función para aplicar bonificación según la clase del personaje
    private function Clase_bonif() {
        switch ($this->clase) {
            case 'Bárbaro':
                $this->fuerzaBasic = 15;
                $this->resistenciaBasic = 12;
                $this->destrezaBasic = 8;
                $this->magiaBasic = 5;
                break;
            case 'Guerrero':
                $this->fuerzaBasic = 12;
                $this->resistenciaBasic = 15;
                $this->destrezaBasic = 10;
                $this->magiaBasic = 5;
                break;
            case 'Cazador':
                $this->fuerzaBasic = 10;
                $this->resistenciaBasic = 10;
                $this->destrezaBasic = 15;
                $this->magiaBasic = 8;
                break;
            case 'Mago':
                $this->fuerzaBasic = 5;
                $this->resistenciaBasic = 8;
                $this->destrezaBasic = 10;
                $this->magiaBasic = 15;
                break;
            default:
                // Si la clase no coincide con ninguna opción, no se aplica bonificación.
                break;
        }
    }
    

    public function __construct($nombre, $clase, $nivel, $fuerzaBasic, $resistenciaBasic, $destrezaBasic, $magiaBasic, $fuerzaBonif, $resistenciaBonif, $destrezaBonif, $magiaBonif, $statPoint, $HP_actual, $MP_actual, $bonificacionesAplicadas, $fuerzaEquip, $resistenciaEquip, $destrezaEquip, $magiaEquip) {
        $this->nombre = $nombre;
        $this->clase = $clase;
        $this->nivel = $nivel;
        $this->fuerzaBasic = $fuerzaBasic;
        $this->resistenciaBasic = $resistenciaBasic;
        $this->destrezaBasic = $destrezaBasic;
        $this->magiaBasic = $magiaBasic;
        $this->fuerzaBonif = $fuerzaBonif;
        $this->resistenciaBonif = $resistenciaBonif;
        $this->destrezaBonif = $destrezaBonif;
        $this->magiaBonif = $magiaBonif;
        $this->statPoint = $statPoint;
        $this->fuerzaEquip = $fuerzaEquip;
        $this->resistenciaEquip = $resistenciaEquip;
        $this->destrezaEquip = $destrezaEquip;
        $this->magiaEquip = $magiaEquip;

        // verifica si ya se genero anteriormente el personaje
        if ($this->bonificacionesAplicadas == false) {
            $this->Clase_bonif();
            $this->bonificacionesAplicadas = true;
        }

        // Calculate and initialize the properties related to calculations
        $this->HP_Max = $this->calculateHPMax();
        $this->MP_Max = $this->calculateMPMax();
        $this->Atk_Fisico = $this->calculateAtkFisico();
        $this->Atk_Magico = $this->calculateAtkMagico();
        $this->Def_Fisica = $this->calculateDefensaFisica();
        $this->Def_Magica = $this->calculateDefensaMagica();
        $this->Hit_rate = $this->calculateHitRate();
        $this->atk_speed = $this->calculateAtkSpeed();
        $this->Crit_chance = $this->calculateCritChance();
        $this->bonificacionesAplicadas = $bonificacionesAplicadas;

        // Initialize HP_actual and MP_actual with the values from HP_Max and MP_Max
        $this->HP_actual = $HP_actual;
        $this->MP_actual = $MP_actual;

        
    }

    //================================ACTUALIZAR ESTADO================================
    function refreshStats(){
        //calcular cambios en estado de personaje.
        $this->HP_Max = $this->calculateHPMax();
        $this->MP_Max = $this->calculateMPMax();
        $this->Atk_Fisico = $this->calculateAtkFisico();
        $this->Atk_Magico = $this->calculateAtkMagico();
        $this->Def_Fisica = $this->calculateDefensaFisica();
        $this->Def_Magica = $this->calculateDefensaMagica();
        $this->Hit_rate = $this->calculateHitRate();
        $this->atk_speed = $this->calculateAtkSpeed();
        $this->Crit_chance = $this->calculateCritChance();
    }

   
    //============================= SETTERS =============================
    public function LevelUp(){
        $this->nivel += 1;

        $this->refreshStats();

        $this->HP_actual = $this->HP_Max;
        $this->MP_actual = $this->MP_Max;
        
    }
    public function setfuerzaBonif(){
        $this->fuerzaBonif += 1;
        $this->statPoint -=1;
        $this->refreshStats();
    }
    public function setDestrezaBonif(){
        $this->destrezaBonif += 1;
        $this->statPoint -=1;
        $this->refreshStats();
    }
    public function setresistenciaBonif(){
        $this->resistenciaBonif += 1;
        $this->statPoint -=1;
        $this->refreshStats();
    }
    public function setmagiaBonif(){
        $this->magiaBonif += 1;
        $this->statPoint -=1;
        $this->refreshStats();
    }
    
    //=============================FORMULAS Y CALCULOS=============================
    
    // Calculate the maximum HP based on attributes
    private function calculateHPMax() {
        return ($this->nivel * 10) + ($this->fuerzaBasic * 5) + ($this->fuerzaBonif * 10); //modificar
    }

    // Calculate the maximum MP based on attributes
    private function calculateMPMax() {
        return ($this->nivel * 5) + ($this->magiaBasic * 10) + ($this->magiaBonif * 5);
    }

    // Calculate physical attack based on attributes
    private function calculateAtkFisico() {
        return ($this->nivel * 2) + ($this->fuerzaBasic * 3) + ($this->fuerzaBonif * 2) + ($this->destrezaBasic);
    }

    // Calculate magical attack based on attributes
    private function calculateAtkMagico() {
        return ($this->nivel * 2) + ($this->magiaBasic * 4) + ($this->magiaBonif * 3) + ($this->destrezaBasic);
    }

    // Calculate physical defense based on attributes
    private function calculateDefensaFisica() {
        return ($this->nivel * 1) + ($this->fuerzaBasic) + ($this->resistenciaBasic * 2) + ($this->resistenciaBonif * 3);
    }

    // Calculate magical defense based on attributes
    private function calculateDefensaMagica() {
        return ($this->nivel * 1) + ($this->magiaBasic * 2) + ($this->resistenciaBasic) + ($this->resistenciaBonif * 3);
    }

    // Calculate hit rate based on attributes
    private function calculateHitRate() {
        return ($this->nivel * 5) + ($this->destrezaBasic * 2) + ($this->destrezaBonif * 5);
    }

    // Calculate attack speed based on attributes
    private function calculateAtkSpeed() {
        return ($this->destrezaBasic * 0.5) + ($this->destrezaBonif * 0.75);
    }

    // Calculate critical chance based on attributes
    private function calculateCritChance() {
        return ($this->destrezaBasic * 0.1) + ($this->destrezaBonif * 0.2);
    }
}

?>