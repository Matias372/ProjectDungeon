====== index.php ======

<?php
session_start();
?>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ProjectDungeon</title>
    <link rel="stylesheet" href="css/general_estilo.css">
    <link rel="stylesheet" href="css/index_estilo.css">
    <link rel="stylesheet" href="css/header_estilo.css">
    <link rel="stylesheet" href="css/footer_estilo.css">
</head>
<body>
    <!-- Incluir el encabezado -->
    <?php include 'html/header.html'; ?>

    <!-- Agregar el section "play" -->
    <section id="play">
        <button onclick="playGame()">Play</button>
    </section>

    <!-- Agregar el section "introduccion" -->
    <section id="introduccion">

        <!-- Primer div -->
        <div>
            <img src="img/Character/NPC_Inn_Icon_Mesa-de-trabajo-1.png" alt="Descripción de la imagen 1">
            <p id=in1>Hola Aventurero, bienvenido a "Project Dungeon". Nuestra ciudad es un lugar simple,
                los aventureros como vos vienen por lo mismo, el portal. Si vuelves vivo trae unas monedas
                y te recibire en la posada con una cerveza lista.
            </p>
            
        </div>

        <!-- Segundo div -->
        <div>
            <img src="img/Character/NPC_Shop_Icon_Mesa-de-trabajo-1.png" alt="Descripción de la imagen 2">
            <p>En la ciudad puedes ir a la tienda para ver los equipos disponibles o puedes ir a la posada
                para descansar y comprar suministros. 
            </p>
        </div>

        <!-- Tercer div -->
        <div>
            <img src="img/Character/NPC_Guild_Icon_Mesa-de-trabajo-1.png" alt="Descripción de la imagen 3">
            <p>Recuerda pasar por el gremio para solicitar y entregar misiones.</p>
        </div>

        <!-- Cuarto div -->
        <div>
            <img src="img/Character/Monsters/Goblinrunts_Icon.png" alt="Descripción de la imagen 4">
            <p>¡¡ESPERAMOS QUE TE DIVIERTAS!!</p>
        </div>
    </section>


    <!-- Incluir el pie de página -->
    <?php include 'html/footer.html'; ?>

    <script>
        
    function playGame() {
        <?php if (isset($_SESSION['loggedin']) && $_SESSION['loggedin'] === true) { ?>
            window.location.href = "php/game.php";
        <?php } else { ?>
            window.location.href = "php/sesion/inicio_sesion.php";
        <?php } ?>
    }
    </script>
</body>
</html>


====== header.html ======

<header>
    <?php
    // Verificar si hay una sesión iniciada
    if (isset($_SESSION['usuario'])) {
        $username = $_SESSION['usuario'];
        $Image = $_SESSION['User_Img'];
    ?>
    
    <div class="logo">
        <?php if (basename($_SERVER['PHP_SELF']) === 'index.php'): ?>
            <a href="index.php"><img src="img/NewLogo-01.png" alt="Logo de la empresa"></a>
        <?php else: ?>
            <a href="../../index.php"><img src="../../img/NewLogo-01.png" alt="Logo de la empresa"></a>
        <?php endif; ?>
    </div>
    
    
    <nav>
        <ul>
            <li class="user-dropdown">
                <div class="user-avatar">
                    <?php if (basename($_SERVER['PHP_SELF']) === 'index.php'): ?>
                        <img src="img/User_img/<?php echo $Image?>" alt="Avatar de usuario">
                    <?php else: ?>
                        <img src="../../img/User_img/<?php echo $Image?>" alt="Avatar de usuario">
                    <?php endif; ?>
                </div>
                <div class="user-info">
                    <div class="username"><?php echo $username; ?></div>
                    <div class="dropdown-content">
                        <ul>
                            <?php if (basename($_SERVER['PHP_SELF']) === 'index.php'): ?>
                                <li><a href="php/sesion/cuenta.php">Cuenta</a></li>
                                <li><a href="php/sesion/logout.php">Salir</a></li>
                            <?php else: ?>
                                <li><a href="cuenta.php">Cuenta</a></li>
                                <li><a href="logout.php">Salir</a></li>
                            <?php endif; ?>
                        </ul>
                    </div>
                </div>
            </li>
            <li class="play-link"> <!-- Agrega una nueva lista para el enlace "Play" -->
                <?php if (basename($_SERVER['PHP_SELF']) === 'index.php'): ?>
                    <a href="php/game/game.php">Play</a>
                <?php else: ?>
                    <a href="../game/game.php">Play</a>
                <?php endif; ?>
            </li>
        </ul>
    </nav>
    <?php } else { ?>
        <div class="logo">
            <?php if (basename($_SERVER['PHP_SELF']) === 'index.php'): ?>
                <a href="index.php"><img src="img/NewLogo-01.png" alt="Logo de la empresa"></a>
            <?php else: ?>
                <a href="../../index.php"><img src="../../img/NewLogo-01.png" alt="Logo de la empresa"></a>
            <?php endif; ?>
        </div>
        
        

        <nav>
            <ul>
                <?php if (basename($_SERVER['PHP_SELF']) === 'index.php'): ?>
                    <li><a href="php/sesion/inicio_sesion.php">Iniciar sesión</a></li>
                    <li><a href="php/sesion/registro.php">Registrarse</a></li>
                <?php else: ?>
                    <li><a href="inicio_sesion.php">Iniciar sesión</a></li>
                    <li><a href="registro.php">Registrarse</a></li>
                <?php endif; ?>
            </ul>
        </nav>
    <?php } ?>
</header>


====== footer.html ======

<footer>
    <div class="attribution">
        <h4>Atribución a:</h4>
        <ul>
            <li><a href="#">Sitio web 1</a></li>
            <li><a href="#">Sitio web 2</a></li>
            <li><a href="#">Sitio web 3</a></li>
        </ul>
        <p>se usaron recursos gratuitos de ellos en la creacion de la pagina y juego</p>
    </div>
    <div class="about-us">
        <h4>Datos sobre nosotros</h4>
        <p>Hasta este momento somos solo 2, Chat GPT y yo. El Project Dungeon es un intento de generar una web con acceso a una base de datos y la implementación de un juego en el medio, el cual se pueda guardar los avances.</p>
    </div>
    <div class="social-media">
        <h4>Redes sociales</h4>
        <ul>
            <li><a href="https://www.facebook.com">Facebook</a></li>
            <li><a href="https://www.twitter.com">Twitter</a></li>
            <li><a href="https://www.instagram.com">Instagram</a></li>
        </ul>
    </div>
</footer>


====== game.html ======

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Dungeon</title>
    <link rel="stylesheet" href="../../css/general_estilo.css">
    <link rel="stylesheet" href="../../css/game_estilo.css">
</head>
<body>
    <section class="game">
        <!-- Título del juego (imagen) -->
        <img src="../../img/Backgrouds/Text_title.png" alt="Project Dungeon" class="title-image">

        <!-- Opciones de juego -->
        <div class="options">
            <button onclick="loadScenario('../../html/game/nueva_partida.html')">Nueva Partida</button>
            <button onclick="loadScenario('../../html/game/cargar_partida.html')">Cargar Partida</button>
        </div>
    </section>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        // Función para cargar el contenido del escenario
        function loadScenario(scenarioURL) {
            $('#game-content').load(scenarioURL);
        }
    </script>
</body>
</html>



====== nueva_partida.html ======

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nueva Partida</title>
    <link rel="stylesheet" href="../../css/general_estilo.css">
    <link rel="stylesheet" href="../../css/nueva_partida_estilo.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="../../js/nueva_partida.js"></script>
    
</head>
<body>
    <h1>Selecciona tu personaje</h1>

    <div class="clase">
        <div class="personaje" id="Barbarian">
            <img src="../../img/Character/Barbarian_Icon_Mesa de trabajo 1.png" alt="Personaje 1" class="personaje-img" onclick="seleccionarClase('Barbarian')">
            <p class="personaje-nombre">Bárbaro</p>
        </div>

        <div class="personaje" id="Mage">
            <img src="../../img/Character/Mage_Icon_Mesa-de-trabajo-1.png" alt="Personaje 2" class="personaje-img" onclick="seleccionarClase('Mage')">
            <p class="personaje-nombre">Mago</p>
        </div>

        <div class="personaje" id="Ranger">
            <img src="../../img/Character/Ranger_Icon_Mesa-de-trabajo-1.png" alt="Personaje 3" class="personaje-img" onclick="seleccionarClase('Ranger')">
            <p class="personaje-nombre">Cazador</p>
        </div>

        <div class="personaje" id="Warrior">
            <img src="../../img/Character/Warrior_Icon_Mesa-de-trabajo-1.png" alt="Personaje 4" class="personaje-img" onclick="seleccionarClase('Warrior')">
            <p class="personaje-nombre">Guerrero</p>
        </div>
    </div>

    <div class="nombre-personaje">
        <label for="nombre">Nombre del personaje:</label>
        <input type="text" id="nombre" placeholder="Ingresa el nombre del personaje">
    </div>

    <button class="crear-btn" onclick="Create_newgame()">Crear</button>
    <button onclick="loadScenario('../../html/game.html')">Volver</button>

    
</body>
</html>


====== cargar_partida.html ======



====== city.html ======

<p>ciudad</p>

====== logros.php ======

<?php
$logros = array(
    array(
        'id' => 1,
        'imagen' => 'Under_construction.jpg',
        'nombre' => 'Registrado',
        'descripcion' => 'Bienvenido'
    ),
    array(
        'id' => 2,
        'imagen' => 'logro2.png',
        'nombre' => 'Logro 2',
        'descripcion' => 'Descripción del logro 2'
    ),
    array(
        'id' => 3,
        'imagen' => 'logro3.png',
        'nombre' => 'Logro 3',
        'descripcion' => 'Descripción del logro 3'
    )
);
?>


====== cambiar_avatar.php ======

<?php
session_start();

// Verificar si hay una sesión iniciada
if(!isset($_SESSION['email'])) {
    header("Location: ../index.php");
    exit();
}
// Incluir el archivo de conexión a la base de datos
include("conexion.php");

// Verificar si se ha enviado el formulario
if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    // Verificar si se ha seleccionado una imagen
    if (isset($_FILES['avatar']) && $_FILES['avatar']['error'] === UPLOAD_ERR_OK) {
        // Obtener la información de la imagen subida
        $avatar = $_FILES['avatar'];
        $avatar_nombre = $avatar['name'];
        $avatar_temporal = $avatar['tmp_name'];

        // Verificar el tipo de imagen (solo se permite JPEG)
        $imagen_info = getimagesize($avatar_temporal);
        $imagen_tipo = $imagen_info['mime'];
        if ($imagen_tipo !== 'image/jpeg') {
            $_SESSION['error_avatar'] = 'Solo se permiten imágenes JPEG (JPG).';
            header("Location: cuenta.php");
            exit();
        }

        // Ruta y nombre del archivo de destino
        $destino = "../img/User_Img/" . $avatar_nombre;

        // Redimensionar la imagen a una anchura de 50px
        $anchura_deseada = 100;
        list($ancho, $alto) = getimagesize($avatar_temporal);
        $ratio = $ancho / $alto;
        $altura_deseada = $anchura_deseada / $ratio;

        $imagen_redimensionada = imagecreatetruecolor($anchura_deseada, $altura_deseada);
        $imagen_original = imagecreatefromjpeg($avatar_temporal);
        imagecopyresampled($imagen_redimensionada, $imagen_original, 0, 0, 0, 0, $anchura_deseada, $altura_deseada, $ancho, $alto);

        // Guardar la imagen redimensionada en el destino
        imagejpeg($imagen_redimensionada, $destino);

        // Actualizar el campo User_Img en la tabla usuarios
        $email = $_SESSION['email'];
        $sql_actualizar = "UPDATE usuarios SET User_Img = '$avatar_nombre' WHERE Email = '$email'";
        $conn->query($sql_actualizar);
        
        // Asignar la nueva imagen como el logo de usuario en $_SESSION['User_Img']
        $_SESSION['User_Img'] = $avatar_nombre;

        // Redirigir de vuelta a la página de cuenta
        header("Location: cuenta.php");
        exit();
    }
}
?>


====== check_partida.php ======

<?php
// Incluir el archivo de conexión a la base de datos
require_once 'conexion.php';

// Verificar si existe una sesión iniciada y obtener el Codigo_Id del usuario
if (session_status() === PHP_SESSION_NONE) {
    session_start();
}

if (isset($_SESSION['loggedin']) && $_SESSION['loggedin'] === true && isset($_SESSION['Id'])) {
    $codigoId = $_SESSION['Id'];

    // Realizar la consulta para verificar si existe una partida para el usuario actual
    $sql = "SELECT * FROM partidas WHERE Cod_User = '$codigoId'";
    $result = $conn->query($sql);

    // Verificar si se obtuvieron resultados
    if ($result->num_rows > 0) {
        // Si existe una partida, enviar respuesta 'exist'
        echo 'exist';
    } else {
        // Si no existe una partida, enviar respuesta 'not_exist'
        echo 'not_exist';
    }
} else {
    // Si no hay una sesión iniciada o no se pudo obtener el Codigo_Id del usuario, enviar respuesta de error
    echo 'error';
}

// Cerrar la conexión a la base de datos (opcional si no se va a realizar más consultas)
$conn->close();
?>


====== GetRandCod.php ======

<?php
// Incluir el archivo de conexión a la base de datos
include("conexion.php");

function generateUUID() {
    global $conn;

    $uuid = '';
    $exists = true;

    while ($exists) {
        // Generar un UUID
        $uuid = generateRandomUUID();

        // Verificar si el UUID ya existe en la tabla usuarios
        $sql_verificar_uuid = "SELECT * FROM usuarios WHERE Id = '$uuid'";
        $result_verificar_uuid = $conn->query($sql_verificar_uuid);

        if ($result_verificar_uuid->num_rows == 0) {
            // El UUID no existe en la tabla usuarios
            $exists = false;
        }
    }

    return $uuid;
}

// Función para generar un UUID (Identificador Único Universal)
function generateRandomUUID() {
    if (function_exists('com_create_guid') === true) {
        return trim(com_create_guid(), '{}');
    }

    return sprintf('%04x%04x-%04x-%04x-%04x-%04x%04x%04x',
        mt_rand(0, 65535), mt_rand(0, 65535), mt_rand(0, 65535),
        mt_rand(16384, 20479), mt_rand(32768, 49151),
        mt_rand(0, 65535), mt_rand(0, 65535), mt_rand(0, 65535)
    );
}
?>


====== record_achievement.php ======

<!--   CODIGO PARA LLAMAR A LA FUNCION DESDE LOS OTROS ARCHIVOS
// Incluir el archivo de funciones
include("funciones.php");

// Llamar a la función RegistrarLogro() para registrar un logro
$codigo_id = $_SESSION['Codigo_Id']; // Obtener el código ID del usuario desde la sesión
$logro_id = 1; // ID del logro a registrar
$resultado = RegistrarLogro($codigo_id, $logro_id);

if ($resultado) {
    echo "El logro se registró exitosamente.";
} else {
    echo "Error al registrar el logro.";
}
-->




<?php
// Incluir el archivo de conexión a la base de datos
include("conexion.php");

// Función para registrar un logro en la tabla usuarios_logros
function RegistrarLogro($codigo_id, $logro_id) {
    global $conn;

    // Verificar si el usuario ya tiene el logro registrado
    $sql_verificar_logro = "SELECT * FROM usuarios_logros WHERE Id_usuario = '$codigo_id' AND Logro_Id = '$logro_id'";
    $result_verificar_logro = $conn->query($sql_verificar_logro);

    if ($result_verificar_logro->num_rows > 0) {
        // El logro ya está registrado para el usuario
        return false;
    } else {
        // Insertar el logro en la tabla usuarios_logros
        $sql_insertar_logro = "INSERT INTO usuarios_logros (Id_usuario, Logro_Id) VALUES ('$codigo_id', '$logro_id')";

        if ($conn->query($sql_insertar_logro) === TRUE) {
            return true; // El logro se registró exitosamente
        } else {
            return false; // Error al registrar el logro
        }
    }
}
?>


====== validar_registro.php ======

<?php
// Incluir el archivo de conexión a la base de datos
include("../sesion/conexion.php");
include("GetRandCod.php");

// Verificar si se ha enviado el formulario
if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    // Obtener los datos del formulario
    $usuario = $_POST['username'];
    $email = $_POST['email'];
    $clave = $_POST['password'];
    
    // Obtener la ruta de la imagen
    $user_img = "Logo_sesion.png";

    // Verificar si el usuario ya existe en la base de datos por nombre de usuario
    $sql_verificar_usuario = "SELECT * FROM usuarios WHERE Usuario = '$usuario'";
    $result_verificar_usuario = $conn->query($sql_verificar_usuario);

    // Verificar si el usuario ya existe en la base de datos por correo electrónico
    $sql_verificar_email = "SELECT * FROM usuarios WHERE Email = '$email'";
    $result_verificar_email = $conn->query($sql_verificar_email);

    if ($result_verificar_usuario->num_rows > 0) {
        // El nombre de usuario ya está registrado
        header("Location: ../sesion/registro.php?error=usuario_existente");
        exit();
    } elseif ($result_verificar_email->num_rows > 0) {
        // El correo electrónico ya está registrado
        header("Location: ../sesion/registro.php?error=email_existente");
        exit();
    } else {
        // Generar un UUID para el "Id" del usuario
        $id = generateUUID();

        // Generar el hash de la clave
        $hashed_clave = password_hash($clave, PASSWORD_DEFAULT);

        // Insertar los datos del usuario en la base de datos con la clave hash y el UUID
        $sql_insertar_usuario = "INSERT INTO usuarios (Id, Usuario, Email, Clave, User_Img) VALUES ('$id', '$usuario', '$email', '$hashed_clave', '$user_img')";

        if ($conn->query($sql_insertar_usuario) === TRUE) {
            // Insertar un nuevo registro en la tabla usuarios_logros
            $logro_id = 1; // ID del logro a insertar
            $sql_insertar_logro = "INSERT INTO usuarios_logros (Id_usuario, Logro_Id) VALUES ('$id', '$logro_id')";
            
            if ($conn->query($sql_insertar_logro) === TRUE) {
                header("Location: ../../index.php?mensaje=exito");
                exit();
            } else {
                echo "Error al insertar el logro: " . $conn->error;
            }
        } else {
            echo "Error al registrar: " . $conn->error;
        }
    }
}

// Cerrar la conexión
$conn->close();
?>


